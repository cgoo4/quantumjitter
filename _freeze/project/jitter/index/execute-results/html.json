{
  "hash": "af0eb72ab6a7e0588de38014b99c1e65",
  "result": {
    "markdown": "---\ntitle: \"Let's Jitter\"\ndate: \"2017-09-12\"\ncategories: [R]\ndescription: \"Welcome to the [tidyverse](https://www.tidyverse.org) with data ingestion, cleaning and tidying. And some visualisations of sales data with a little jittering.\"\nbibliography: references.bib\n---\n\n\n![](feature.gif){fig-alt=\"A silhouette of the Houses of Parliament with the text \\\"G9\\\" instead of Big Ben's clock. In the sky, three clouds jitter and leaves are swept by the wind across the word \\\"Autumn\\\".\"}\n\nWelcome to the [tidyverse](https://www.tidyverse.org) [@tidyverse] with data ingestion, cleaning and tidying. And some visualisations of sales data with a little jittering.\n\nThis first little project uses the tidyverse collection of packages to import, explore and visualise some sales data. The UK Government's Digital Marketplace provides a rich and varied source of public data [under the Open Government Licence](https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/) [^1].\n\n[^1]:  Contains public sector information licensed under the Open Government Licence v3.0.\n\nThe marketplace was set up with an intent to break down barriers that impede Small and Medium Enterprises (SMEs) from bidding for Public Sector contracts. So, let's see how that's going.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(conflicted)\nlibrary(tidyverse)\nconflict_prefer_all(\"dplyr\", quiet = TRUE)\nconflict_prefer(\"as_date\", \"lubridate\")\nlibrary(clock)\nconflict_prefer(\"date_format\", \"clock\")\nlibrary(janitor)\nlibrary(scales)\nlibrary(wesanderson)\nlibrary(glue)\nlibrary(usedthese)\n\nconflict_scout()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntheme_set(theme_bw())\n\n(cols <- wes_palette(\"Royal1\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/theme-1.png){width=100%}\n:::\n:::\n\n\nThe tidyverse framework sits at the heart of all my data science work as evidenced in my [favourite things](/project/box). So I'll begin by using two of my most used tidyverse packages (readr [@readr] and dplyr [@dplyr]) to import and tidy the cloud services (G-Cloud) sales data.\n\nWild data are often scruffy affairs. Cleaning and tidying is a necessary first step. In the case of these data, there are characters in an otherwise numeric spend column. And the date column is a mix of two formats.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- str_c(\n  \"https://www.gov.uk/government/\",\n  \"uploads/system/uploads/attachment_data/\",\n  \"file/639799/g-cloud-sales-figures-july2017.csv\"\n)\n\ngcloud_df <-\n  read_csv(url) |> \n  clean_names() |> \n  mutate(\n    evidenced_spend = str_remove_all(evidenced_spend, \"[^0-9-]\") |>\n      parse_number(),\n    spend_date = as.Date(as.numeric(return_month), origin = \"1899-12-30\"),\n    spend_date = if_else(\n      is.na(spend_date),\n      dmy(return_month),\n      spend_date\n    ),\n    sme_status = if_else(sme_status == \"SME\", \"SME\", \"Non-SME\"),\n    sme_spend = if_else(sme_status == \"SME\", evidenced_spend, 0)\n  )\n```\n:::\n\n\nNow we can summarise and visualise how the SME share has changed over time using the ggplot2 package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshare_df <- gcloud_df |> \n  summarise(\n    evidenced_spend = sum(evidenced_spend, na.rm = TRUE),\n    sme_spend = sum(sme_spend, na.rm = TRUE),\n    pct = sme_spend / evidenced_spend, \n    .by = spend_date\n  ) |> \n  arrange(spend_date)\n\nlast_date <- gcloud_df |> \n  summarise(max(spend_date)) |> \n  pull() |> \n  date_format(format = \"%B %d, %Y\")\n\nshare_df |> \n  ggplot(aes(spend_date, pct)) +\n  geom_point(colour = cols[4]) +\n  geom_smooth(colour = cols[2], fill = cols[3]) +\n  scale_y_continuous(labels = label_percent()) +\n  scale_x_date(date_breaks = \"years\", date_labels = \"%Y\") +\n  labs(\n    x = NULL, y = NULL,\n    title = glue(\"SME Share of G-Cloud to {last_date}\"), \n    subtitle = \"Dots = % Monthly Sales via SMEs\",\n    caption = \"Source: GOV.UK G-Cloud Sales\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/share-1.png){width=100%}\n:::\n:::\n\n\nSales grew steadily to a cumulative £2.4B by July 2017. And as the volume of sales grew, an increasingly clearer picture of sustained growth in the SME share emerged. However, in those latter few months, SMEs lost a little ground.\n\nDig a little deeper, and one can also see variation by sub-sector. And that's after setting aside those buyers with cumulative G-Cloud spend below £100k, where large enterprise suppliers are less inclined to compete.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsector_df <- gcloud_df |>\n  mutate(sector = if_else(\n    sector %in% c(\"Central Government\", \"Local Government\", \n                  \"Police\", \"Health\"), sector, \"Other Sector\")\n    ) |>\n  summarise(\n    evidenced_spend = sum(evidenced_spend, na.rm = TRUE),\n    sme_spend = sum(sme_spend, na.rm = TRUE),\n    pct = sme_spend / evidenced_spend,\n    .by = c(customer_name, sector)\n  ) |>\n  filter(evidenced_spend >= 100000) |>\n  mutate(median_pct = median(pct), .by = sector) |>\n  mutate(sector = fct_reorder(sector, median_pct))\n\nn_df <- sector_df |> summarise(n = n(), .by = sector)\n\nsector_df |> \n  ggplot(aes(sector, pct)) +\n  geom_boxplot(outlier.shape = FALSE, fill = cols[3]) +\n  geom_jitter(width = 0.2, alpha = 0.5, colour = cols[2]) +\n  geom_label(aes(y = .75, label = glue(\"n = {n}\")),\n    data = n_df,\n    fill = cols[1], colour = \"white\"\n  ) +\n  scale_y_continuous(labels = label_percent()) +\n  labs(\n    x = NULL, y = NULL,\n    title = glue(\"SME Share of G-Cloud to {last_date}\"),\n    subtitle = \"% Sales via SMEs for Buyers with Cumulative Sales >= £100k\",\n    caption = \"Source: gov.uk G-Cloud Sales\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/sub-sector-1.png){width=100%}\n:::\n:::\n\n\nThe [box plot](https://en.wikipedia.org/wiki/Box_plot), overlaid with jittered points to avoid over-plotting, shows:\n\n-   Central government, with its big-spending departments, and police favouring large suppliers. This may reflect, among other things, their ability to scale.\n-   Local government and health, in contrast, favouring SMEs. And this despite their looser tether to central government strategy.\n\nSo, irrespective of whether service integration is taken in-house or handled by a service integrator, large enterprise suppliers have much to offer:\n\n-   The ability to deliver at scale;\n-   A breadth and depth of capabilities exploitable during discovery to better articulate the \"art of the possible\";\n-   A re-assurance that there is always extensive capability on hand.\n\nSMEs offer flexibility, fresh thinking and broader competition, often deploying their resources and building their mission around a narrower focus. They tend to do one thing, or a few things, exceptionally well.\n\nThese data are explored further in [Six months later](/project/six) and [Can Ravens Forecast](/project/forecast).\n\n## R Toolbox\n\nSummarising below the packages and functions used in this post enables me to separately create a [toolbox visualisation](/project/box) summarising the usage of packages and functions across all posts.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nused_here()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"usedthese table table-striped\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Package </th>\n   <th style=\"text-align:left;\"> Function </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> base </td>\n   <td style=\"text-align:left;\"> as.Date[1], as.numeric[1], c[2], is.na[1], library[8], max[1], sum[4] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> clock </td>\n   <td style=\"text-align:left;\"> date_format[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> conflicted </td>\n   <td style=\"text-align:left;\"> conflict_prefer[2], conflict_prefer_all[1], conflict_scout[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> dplyr </td>\n   <td style=\"text-align:left;\"> arrange[1], filter[1], if_else[4], mutate[4], n[1], pull[1], summarise[4] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> forcats </td>\n   <td style=\"text-align:left;\"> fct_reorder[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ggplot2 </td>\n   <td style=\"text-align:left;\"> aes[3], geom_boxplot[1], geom_jitter[1], geom_label[1], geom_point[1], geom_smooth[1], ggplot[2], labs[2], scale_x_date[1], scale_y_continuous[2], theme_bw[1], theme_set[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> glue </td>\n   <td style=\"text-align:left;\"> glue[3] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> janitor </td>\n   <td style=\"text-align:left;\"> clean_names[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> lubridate </td>\n   <td style=\"text-align:left;\"> dmy[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> readr </td>\n   <td style=\"text-align:left;\"> parse_number[1], read_csv[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> scales </td>\n   <td style=\"text-align:left;\"> label_percent[2] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> stats </td>\n   <td style=\"text-align:left;\"> median[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> stringr </td>\n   <td style=\"text-align:left;\"> str_c[1], str_remove_all[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> usedthese </td>\n   <td style=\"text-align:left;\"> used_here[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wesanderson </td>\n   <td style=\"text-align:left;\"> wes_palette[1] </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}